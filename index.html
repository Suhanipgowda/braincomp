<!DOCTYPE html>
<html>
<head>
    <title>EEG Live Web Graph</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body style="font-family: Arial; padding: 20px;">
    <h1>ðŸ§  EEG Live Web Graph</h1>

    <button onclick="startSim()">Start</button>
    <button onclick="stopSim()">Stop</button>
    <button onclick="setActivity('rest')">Rest</button>
    <button onclick="setActivity('walking')">Walking</button>
    <button onclick="setActivity('running')">Running</button>

    <canvas id="eegChart" width="600" height="300"></canvas>

    <script>
        const api = "http://127.0.0.1:8000"; // Replace with your laptop's IP address 

        // Function to start the EEG simulation by hitting the backend /start API
        function startSim() {
            fetch(api + "/start")
                .then(response => response.json())
                .then(data => {
                    console.log(data);  // Check the response from the backend
                    alert('Simulation Started');
                })
                .catch(error => {
                    console.log("Error starting simulation:", error);
                    alert("Error starting simulation.");
                });
        }

        // Function to stop the EEG simulation by hitting the backend /stop API
        function stopSim() {
            fetch(api + "/stop")
                .then(response => response.json())
                .then(data => {
                    console.log(data);  // Check the response from the backend
                    alert('Simulation Stopped');
                })
                .catch(error => {
                    console.log("Error stopping simulation:", error);
                    alert("Error stopping simulation.");
                });
        }

        // Function to set the current activity by calling /set_activity/{mode} API
        function setActivity(mode) {
            fetch(api + "/set_activity/" + mode)
                .then(response => response.json())
                .then(data => {
                    console.log(data);  // Check the activity change response
                    alert('Activity set to: ' + mode);
                })
                .catch(error => {
                    console.log("Error setting activity:", error);
                    alert("Error setting activity.");
                });
        }

        // Set up the EEG graph with Chart.js
        const ctx = document.getElementById("eegChart").getContext("2d");
        const chart = new Chart(ctx, {
            type: "line",
            data: {
                labels: [],
                datasets: [
                    { label: "Alpha", data: [], borderColor: "yellow" },
                    { label: "Beta", data: [], borderColor: "red" },
                    { label: "Gamma", data: [], borderColor: "green" }
                ]
            }
        });

        // Update the graph with real-time data every 200 ms
        setInterval(async () => {
            const res = await fetch(api + "/eeg");
            const data = await res.json();

            chart.data.labels.push("");  // Add a new empty label for each data point
            chart.data.datasets[0].data.push(data.alpha);  // Alpha data
            chart.data.datasets[1].data.push(data.beta);   // Beta data
            chart.data.datasets[2].data.push(data.gamma);  // Gamma data

            if (chart.data.labels.length > 100) {  // Limit graph data length
                chart.data.labels.shift();
                chart.data.datasets.forEach(d => d.data.shift());
            }

            chart.update();
        }, 200);
    </script>
</body>
</html>

